import { __awaiter } from "tslib";
import { lensImagePickerError } from "../namedErrors";
import { Injectable } from "../dependency-injection/Injectable";
import { lensCoreFactory } from "../lens-core-module";
import { getLogger } from "../logger/logger";
import { pickClientImage } from "./imagePicker";
const logger = getLogger("lensClientInterface");
/**
 * Registers client interface handler in LensCore.
 *
 * @internal
 * @param lensCore LensCore instance to register in.
 * @param sessionErrors EventTarget to dispatch errors in.
 */
export const registerLensClientInterfaceHandler = Injectable("registerLensClientInterfaceHandler", [lensCoreFactory.token], (lensCore) => {
    // Make sure we are compatible with previous LensCore versions
    if (!lensCore.setClientInterfaceRequestHandler) {
        logger.warn("Current LensCore version doesn't support lens client interface requests");
        return;
    }
    lensCore.setClientInterfaceRequestHandler(({ data, interfaceControl, interfaceAction }) => __awaiter(void 0, void 0, void 0, function* () {
        if (interfaceControl === lensCore.InterfaceControl.ImagePicker &&
            interfaceAction === lensCore.InterfaceAction.Show) {
            yield pickClientImage(data, lensCore).catch((error) => {
                logger.error(lensImagePickerError("Error occurred while attempting to select an image file for the lens request.", error));
            });
        }
    }));
});
//# sourceMappingURL=lensClientInterface.js.map