{"version":3,"file":"dialog.js","sourceRoot":"","sources":["../../src/common/dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import { fromEvent, map, merge, take } from \"rxjs\";\n\n/**\n * Dialog options.\n */\ninterface DialogOptions<Keys extends string> {\n    /**\n     * Element to attach the dialgo to.\n     */\n    container: HTMLElement;\n    /**\n     * Body content string. Can be HTML string.\n     */\n    body?: string;\n    /**\n     * Title string to render. Can be HTML string.\n     */\n    title?: string;\n    /**\n     * Accessible dialog title text,\n     * especially useful for voice-over features when the title field is an image.\n     */\n    titleText?: string;\n    /**\n     * \"data-testid\" attribute for testing purposes.\n     */\n    dataTestId?: string;\n    /**\n     * Use the lang field to set \"lang\" attribute on the dialog if that should be different from the parent page.\n     */\n    lang?: string;\n    /**\n     * Accessbile text of dismiss (X) button,\n     * especially useful for voice-over features when the title field is an image.\n     */\n    dismissButtonText?: string;\n    /**\n     * Buttons to display at the bottom of the dialog.\n     */\n    buttons?: DialogButton<Keys>[];\n}\n\n/**\n * Dialog button.\n */\ninterface DialogButton<Key extends string> {\n    /**\n     * Button text.\n     */\n    text: string;\n    /**\n     * Value returned by the {@link showDialog} function after the button is clicked.\n     */\n    key: Key;\n    /**\n     * Whether to apply \"secondary\" styles on the button.\n     */\n    isSecondary?: boolean;\n}\n\ntype DismissKey = \"dismiss\";\n\nconst stylesCss = `\ndialog {\n    display: flex;\n    flex-direction: column;\n\n    background-color: #fff;\n    border: #efefef 1px solid;\n    border-radius: 20px;\n    box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.3);\n\n    max-width: 80vw;\n    max-height: 80vh;\n    padding: 44px 0 24px 0;\n\n    font-size: 16px;\n    font-family: sans-serif;\n    font-style: normal;\n    font-weight: 600;\n    line-height: 24px;\n}\n\ndialog::backdrop {\n    background-color: rgba(0, 0, 0, 0.4);\n}\n\n.title {\n    color: #16191C;\n    padding: 0 32px;\n    text-align: center;\n}\n\n.body {\n    color: #656D78;\n    font-size: 14px;\n    font-weight: 500;\n    margin-top: 16px;\n    max-width: 350px;\n    padding: 0 32px;\n    overflow: auto;\n}\n\na {\n    color: rgb(78, 171, 248);\n}\n\nbutton {\n    cursor: pointer;\n}\n\nbutton.dismiss {\n    position: absolute;\n    top: 7px;\n    right: 7px;\n    padding: 0;\n    height: 36px;\n    width: 36px;\n    margin: 0;\n    background-color: transparent;\n    border: 0;\n}\n\nbutton.dismiss svg {\n    fill: black;\n}\n\n.buttons {\n    margin-top: 8px;\n    padding: 0 32px;\n}\n\n.buttons button {\n    background: #0FADFF;\n    border: 0;\n    border-radius: 25px;\n\n    width: 100%;\n    padding: 1rem;\n    margin-top: 8px;\n\n    color: #fff;\n    font-weight: inherit;\n    font-family: inherit;\n    font-size: inherit;\n    font-style: inherit;\n}\n\n.buttons button.secondary {\n    background-color: transparent;\n    color: #656D78;\n}\n\n// Proper filling of X button in High Contrast themes\n@media (forced-colors: active) {\n    button.dismiss svg {\n        fill: ButtonText;\n    }\n}\n`;\n\nfunction getDismissButtonHtml(button: DialogButton<DismissKey>) {\n    /* eslint-disable max-len */\n    return `\n        <button class=\"dismiss\" autofocus data-key=${button.key}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" role=\"img\" width=\"36\" height=\"36\" viewBox=\"0 0 36 36\">\n                <title>${button.text}</title>\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12.6763 11.2621C12.2858 10.8716 11.6527 10.8716 11.2621 11.2621C10.8716 11.6527 10.8716 12.2858 11.2621 12.6763L16.5858 18L11.2621 23.3237C10.8716 23.7142 10.8716 24.3474 11.2621 24.7379C11.6527 25.1284 12.2858 25.1284 12.6764 24.7379L18 19.4142L23.3237 24.7379C23.7142 25.1284 24.3474 25.1284 24.7379 24.7379C25.1284 24.3474 25.1284 23.7142 24.7379 23.3237L19.4142 18L24.7379 12.6763C25.1284 12.2858 25.1284 11.6527 24.7379 11.2621C24.3474 10.8716 23.7142 10.8716 23.3237 11.2621L18 16.5858L12.6763 11.2621Z\" fill-opacity=\"0.4\"/>\n            </svg>\n        </button>`;\n    /* eslint-enable */\n}\n\nfunction getTitleHtml(title: string | undefined) {\n    return title ? `<div class=\"title\" role=\"heading\">${title}</div>` : \"\";\n}\n\nfunction getBodyHtml(body: string | undefined) {\n    return body ? `<div class=\"body\">${body}</div>` : \"\";\n}\n\nfunction getButtonHtml<Key extends string>(button: DialogButton<Key>) {\n    return `<button data-key=\"${button.key}\"${button.isSecondary ? ` class=\"secondary\"` : \"\"}>${button.text}</button>`;\n}\n\nfunction getButtonsHtml<Key extends string>(buttons: DialogButton<Key>[]) {\n    if (buttons.length === 0) return \"\";\n    return `\n        <div class=\"buttons\">\n        ${buttons.map((b) => getButtonHtml(b)).join(\"\\n\")}\n        </div>`;\n}\n\nfunction setAttribute(element: HTMLElement, attr: string, value: string | undefined) {\n    if (value) element.setAttribute(attr, value);\n}\n\nexport function showDialog<Keys extends string>(options: DialogOptions<Keys>): Promise<Keys | DismissKey> {\n    return new Promise((res) => {\n        const element = document.createElement(\"div\");\n        setAttribute(element, \"data-testid\", options.dataTestId);\n        const shadow = element.attachShadow({ mode: \"open\" });\n\n        const style = document.createElement(\"style\");\n        shadow.appendChild(style);\n        style.innerHTML = stylesCss;\n\n        const prompt = document.createElement(\"dialog\");\n        setAttribute(prompt, \"aria-label\", options.titleText ?? options.title);\n        setAttribute(prompt, \"lang\", options.lang);\n        setAttribute(prompt, \"dir\", \"auto\");\n        shadow.appendChild(prompt);\n\n        prompt.innerHTML = `\n            ${getDismissButtonHtml({ key: \"dismiss\", text: options.dismissButtonText ?? \"Dismiss\" })}\n            ${getTitleHtml(options.title)}\n            ${getBodyHtml(options.body)}\n            ${getButtonsHtml(options.buttons ?? [])}\n        `;\n\n        const buttonsElements = Array.from(prompt.querySelectorAll(\"button\"));\n        merge(\n            ...buttonsElements.map((b) => fromEvent(b, \"click\").pipe(map(() => b.dataset.key as Keys))),\n            fromEvent(prompt, \"cancel\").pipe(map(() => \"dismiss\" as const))\n        )\n            .pipe(take(1))\n            .subscribe({ next: res, complete: () => element.remove() });\n        options.container.appendChild(element);\n        prompt.showModal();\n    });\n}\n"]}