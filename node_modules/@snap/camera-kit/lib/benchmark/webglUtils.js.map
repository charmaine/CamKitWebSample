{"version":3,"file":"webglUtils.js","sourceRoot":"","sources":["../../src/benchmark/webglUtils.ts"],"names":[],"mappings":"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","sourcesContent":["import { webGLError } from \"../namedErrors\";\n\nconst webGLEntityCreationError = (name: string) => webGLError(`Could not create ${name}.`);\n\nexport function createProgram(gl: WebGL2RenderingContext, vertexSource: string, fragmentSource: string): WebGLProgram {\n    const vertexShader = createShader(gl, vertexSource, gl.VERTEX_SHADER);\n    const fragmentShader = createShader(gl, fragmentSource, gl.FRAGMENT_SHADER);\n    const program = gl.createProgram();\n    if (!program) throw webGLEntityCreationError(\"WebGLProgram\");\n    gl.attachShader(program, vertexShader);\n    gl.deleteShader(vertexShader);\n\n    gl.attachShader(program, fragmentShader);\n    gl.deleteShader(fragmentShader);\n\n    gl.linkProgram(program);\n\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n    if (!success) {\n        const message = gl.getProgramInfoLog(program);\n        gl.deleteProgram(program);\n        throw webGLError(`WebGLProgram linking failed with status: ${message}.`);\n    }\n\n    return program;\n}\n\nexport function createShader(gl: WebGL2RenderingContext, source: string, type: number): WebGLShader {\n    const shader = gl.createShader(type);\n    if (!shader) throw webGLEntityCreationError(`WebGLShader (type ${type})`);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n    if (!success) {\n        const message = gl.getShaderInfoLog(shader);\n        gl.deleteShader(shader);\n        throw webGLError(`WebGLShader (type ${type}) compilation failed with status: ${message}.`);\n    }\n    return shader;\n}\n\nexport function createTexture(gl: WebGL2RenderingContext, width: number, height: number): WebGLTexture {\n    const texture = gl.createTexture();\n    if (!texture) throw webGLEntityCreationError(\"WebGLTexture\");\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    return texture;\n}\n\nexport function createFramebuffer(gl: WebGL2RenderingContext, texture: WebGLTexture): WebGLFramebuffer {\n    const framebuffer = gl.createFramebuffer();\n    if (!framebuffer) throw webGLEntityCreationError(\"WebGLFramebuffer\");\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n    return framebuffer;\n}\n\nexport function setUniform1i(gl: WebGL2RenderingContext, program: WebGLProgram, name: string, data: number): void {\n    gl.uniform1i(gl.getUniformLocation(program, name), data);\n}\n\nexport function setUniform4f(\n    gl: WebGL2RenderingContext,\n    program: WebGLProgram,\n    name: string,\n    data: [number, number, number, number]\n): void {\n    gl.uniform4f(gl.getUniformLocation(program, name), ...data);\n}\n\nexport function promiseSync(gl: WebGL2RenderingContext): Promise<void> {\n    const sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0);\n    if (!sync) throw webGLEntityCreationError(\"WebGLSync\");\n    gl.flush();\n    return new Promise((resolve, reject) => {\n        const waitForSync = (): void => {\n            const glEnum = gl.clientWaitSync(sync, 0, 0);\n            switch (glEnum) {\n                case gl.TIMEOUT_EXPIRED:\n                    setTimeout(waitForSync);\n                    return;\n                case gl.WAIT_FAILED:\n                    gl.deleteSync(sync);\n                    return reject();\n                case gl.ALREADY_SIGNALED:\n                case gl.CONDITION_SATISFIED:\n                    gl.deleteSync(sync);\n                    return resolve();\n            }\n        };\n        waitForSync();\n    });\n}\n"]}