{"version":3,"file":"metricsHandler.js","sourceRoot":"","sources":["../../src/metrics/metricsHandler.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,oCAAoC,CAAC;AAEhE,OAAO,EAAE,mCAAmC,EAAE,MAAM,iDAAiD,CAAC;AACtG,OAAO,EAAE,mBAAmB,EAAE,MAAM,iCAAiC,CAAC;AACtE,OAAO,EAAE,yBAAyB,EAAE,MAAM,iCAAiC,CAAC;AAC5E,OAAO,EAAkB,qBAAqB,EAAE,MAAM,0BAA0B,CAAC;AAEjF,MAAM,4BAA4B,GAAG,IAAI,CAAC,CAAC,8CAA8C;AAEzF;;GAEG;AACH,MAAM,CAAC,MAAM,qBAAqB,GAAG,UAAU,CAC3C,gBAAgB,EAChB,CAAC,mCAAmC,CAAC,KAAK,EAAE,qBAAqB,CAAC,KAAK,CAAU,EACjF,CAAC,YAA0B,EAAE,cAA8B,EAAE,EAAE;IAC3D,OAAO,IAAI,mBAAmB,CAAC,YAAY,CAAC,CAAC,GAAG,CAC5C,yBAAyB,CAAC,4BAA4B,EAAE,cAAc,CAAC,CAC1E,CAAC,OAAO,CAAC;AACd,CAAC,CACJ,CAAC","sourcesContent":["import { Injectable } from \"../dependency-injection/Injectable\";\nimport { FetchHandler } from \"../handlers/defaultFetchHandler\";\nimport { cameraKitServiceFetchHandlerFactory } from \"../handlers/cameraKitServiceFetchHandlerFactory\";\nimport { HandlerChainBuilder } from \"../handlers/HandlerChainBuilder\";\nimport { createRateLimitingHandler } from \"../handlers/rateLimitingHandler\";\nimport { PageVisibility, pageVisibilityFactory } from \"../common/pageVisibility\";\n\nconst METRIC_REQUEST_RATE_LIMIT_MS = 1000; // send at most one metric request per second.\n\n/**\n * @internal\n */\nexport const metricsHandlerFactory = Injectable(\n    \"metricsHandler\",\n    [cameraKitServiceFetchHandlerFactory.token, pageVisibilityFactory.token] as const,\n    (fetchHandler: FetchHandler, pageVisibility: PageVisibility) => {\n        return new HandlerChainBuilder(fetchHandler).map(\n            createRateLimitingHandler(METRIC_REQUEST_RATE_LIMIT_MS, pageVisibility)\n        ).handler;\n    }\n);\n"]}